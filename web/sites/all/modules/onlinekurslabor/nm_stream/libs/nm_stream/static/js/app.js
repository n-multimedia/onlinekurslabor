webpackJsonp([1],{"0eAL":function(t,e){},"1/oy":function(t,e){},"4KCC":function(t,e){},"7UhR":function(t,e){},"7w68":function(t,e){},"9BHd":function(t,e){},CubC:function(t,e){},FWo4:function(t,e){},GfHa:function(t,e){},GgjP:function(t,e){},HtCJ:function(t,e){},Id91:function(t,e){},JWrn:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("7+uW"),n={props:["streamOptions","post","editComment"],name:"stream-comment-form",methods:{resizeTextarea:function(t){this.resizeTextareaElement(t.target),this.resizeCommentFormContainer()},resizeCommentFormContainer:function(){this.editComment&&(this.$parent.$el.querySelector(".stream-comment").style.height=150+this.$el.querySelector("textarea").scrollHeight+"px",console.log(this.$parent.$el.querySelector(".stream-comment").style.height))},saveComment:function(){var t=this;this.busyLoading=!0;var e=this,s={};if(s.body=this.bodyText,this.editComment){var n=this.$config.get("api.apiCommentUpdateUrl").replace("%comment",this.editComment.cid).replace("%token",this.streamOptions.token);i.a.axios.post(n,s,{withCredentials:!0}).then(function(s){e.resetForm(),1===s.data.status?(e.editComment.body_formatted=s.data.commentData.body_formatted,e.editComment.body=s.data.commentData.body,e.resetForm()):alert(t.$t("warning.error_occured_please_repeat_your_action"))})}else{var a=this.$config.get("api.apiCommentAddUrl").replace("%node",this.post.nid).replace("%token",this.streamOptions.token);i.a.axios.post(a,s,{withCredentials:!0}).then(function(s){if(e.resetForm(),1===s.data.status){var i=s.data.commentData,n=s.data.userData;e.$emit("stream-comment-added",i),e.$emit("stream-user-added",n)}else alert(t.$t("warning.error_occured_please_repeat_your_action"))})}},resizeTextareaElement:function(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"},escPressed:function(){0===this.bodyText.length&&this.resetForm()},resetForm:function(){this.editComment?(this.$emit("form-edit-canceled"),this.$parent.$el.querySelector(".stream-comment").style.height="auto"):(this.bodyText="",this.formActive=!1,this.$el.querySelector("textarea.stream-comment-body").blur(),this.$el.querySelector("textarea.stream-comment-body").style.height="auto"),this.busyLoading=!1},submitOnCtrlEnter:function(t){t.ctrlKey&&this.saveComment()},initializeComment:function(){var t=this;this.editComment&&(this.formActive=!0,this.bodyText=this.editComment.body,this.$nextTick(function(){t.resizeTextareaElement(t.$el.querySelector("textarea")),t.resizeCommentFormContainer()}))},updateAuthor:function(){this.author=this.streamOptions.loggedInUser,this.editComment&&(this.author=this.editComment.user)}},mounted:function(){var t=this;this.$nextTick(function(){t.$el.setAttribute("style","height:"+t.$el.scrollHeight+"px;overflow-y:hidden;"),t.$el.addEventListener("input",t.resizeTextarea)}),this.updateAuthor()},beforeDestroy:function(){this.$el.removeEventListener("input",this.resizeTextarea)},render:function(){return this.$slots.default[0]},data:function(){return{formActive:!1,busyLoading:!1,busyLoadingColor:"#888",busyLoadingSize:"10px",author:null,bodyText:""}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"stream-comment-from card"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-2"},[s("transition",{attrs:{name:"fade"}},[t.formActive?s("img",{key:t.formActive,staticClass:"card-img-top rounded-circle",attrs:{src:t.author.avatarUrl,title:t.author.name}}):t._e()])],1),t._v(" "),s("div",{staticClass:"col-10"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bodyText,expression:"bodyText"}],staticClass:"stream-comment-body",attrs:{name:"body",disabled:t.busyLoading,placeholder:t.$t("placeholder.your_comment_message")},domProps:{value:t.bodyText},on:{keyup:[function(e){return"button"in e||!t._k(e.keyCode,"esc",27,e.key,"Escape")?t.escPressed(e):null},function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.submitOnCtrlEnter(e):null}],focus:function(e){t.formActive=!0},input:function(e){e.target.composing||(t.bodyText=e.target.value)}}}),t._v(" "),s("transition",{attrs:{name:"fade"}},[s("div",{key:t.formActive,staticClass:"row stream-action-2"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"row"},[t.formActive?s("div",{staticClass:"col-12 action-buttons"},[s("button",{staticClass:"btn btn-outline-primary stream-comment-post float-right",attrs:{disabled:this.bodyText.length<1||t.busyLoading},on:{click:t.saveComment}},[t._v(t._s(t.$t("button.post")))]),t._v(" "),s("button",{staticClass:"btn btn-outline-secondary stream-comment-cancel float-right",attrs:{disabled:t.busyLoading},on:{click:t.resetForm}},[t._v(t._s(t.$t("button.cancel")))]),t._v(" "),s("pulse-loader",{attrs:{loading:t.busyLoading,color:t.busyLoadingColor,size:t.busyLoadingSize}})],1):t._e()])])])])],1)])])},staticRenderFns:[]};var o=s("VU/8")(n,a,!1,function(t){s("FWo4")},"data-v-b2285daa",null).exports,r={props:["streamOptions","comment","user"],components:{StreamCommentForm:o},name:"stream-comment",data:function(){return{}},computed:{canEdit:function(){return this.comment.permissions.canEdit},canDelete:function(){return this.comment.permissions.canDelete}},methods:{editComment:function(t){var e=this;this.$el.classList.add("flip-active"),setTimeout(function(){e.$refs.streamCommentForm.initializeComment(),e.$refs.backDelete.classList.add("hide"),e.$refs.backEdit.classList.remove("hide"),e.$refs.streamCommentForm.initializeComment()},200)},deleteComment:function(t){var e=this;setTimeout(function(){e.$el.classList.add("flip-active"),e.$refs.backEdit.classList.add("hide"),e.$refs.backDelete.classList.remove("hide")},200)},onDelete:function(t){var e=this,s=this,n=this.$config.get("api.apiCommentDeleteUrl").replace("%comment",this.comment.cid).replace("%token",this.streamOptions.token);i.a.axios.get(n,{withCredentials:!0}).then(function(t){1===t.data.status?(s.$emit("stream-comment-deleted",s.comment),e.$el.classList.remove("flip-active")):alert(e.$t("warning.error_occured_please_repeat_your_action"))})},onDeleteCancel:function(t){this.$el.classList.remove("flip-active")},editCanceled:function(t){this.$el.classList.remove("flip-active")}}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"card-flip"},[s("div",{staticClass:"flip"},[s("div",{staticClass:"front"},[s("div",{staticClass:"stream-comment card"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-2"},[s("img",{staticClass:"card-img-top rounded-circle",attrs:{src:t.user.avatarUrl,title:t.user.name}})]),t._v(" "),s("div",{staticClass:"col-10"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[t.canEdit||t.canDelete?s("div",[s("b-dropdown",{staticClass:"post-actions-dropdown m-md-2 float-right",attrs:{text:"...",offset:"-120"}},[t.canEdit?s("b-dropdown-item",{on:{click:t.editComment}},[t._v(t._s(t.$t("button.edit")))]):t._e(),t._v(" "),t.canDelete?s("b-dropdown-item",{on:{click:t.deleteComment}},[t._v(t._s(t.$t("button.delete")))]):t._e()],1)],1):t._e(),t._v(" "),s("div",{staticClass:"username"},[s("a",{attrs:{href:t.user.profileUrl}},[t._v(t._s(t.user.name))])]),t._v(" "),s("div",{staticClass:"created"},[s("span",{attrs:{title:t._f("moment")(t.comment.created,"L LT")}},[t._v(" "+t._s(t._f("moment")(t.comment.created,"from")))])])])]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 body"},[s("p",{attrs:{tag:"p"},domProps:{innerHTML:t._s(t.comment.body_formatted)}})])])])])])]),t._v(" "),s("div",{ref:"backEdit",staticClass:"back-edit"},[s("div",{staticClass:"stream-comment card"},[s("stream-comment-form",{ref:"streamCommentForm",attrs:{streamOptions:t.streamOptions,editComment:t.comment},on:{"form-edit-canceled":function(e){t.editCanceled()}}})],1)]),t._v(" "),s("div",{ref:"backDelete",staticClass:"back-delete"},[s("div",{staticClass:"stream-post card"},[s("h4",[t._v(t._s(t.$t("warning.delete_comment_really_want_to")))]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("\n          "+t._s(t.$t("warning.delete_comment_action_cannot_be_undone"))+"\n        ")]),t._v(" "),s("div",{staticClass:"float-right"},[s("button",{staticClass:"btn btn-outline-danger float-right",on:{click:function(e){t.onDelete()}}},[t._v(t._s(t.$t("button.delete")))]),t._v(" "),s("button",{staticClass:"btn btn-outline-secondary float-right",on:{click:function(e){t.onDeleteCancel()}}},[t._v(t._s(t.$t("button.cancel")))])])])])])])},staticRenderFns:[]};var c=s("VU/8")(r,l,!1,function(t){s("RvtP")},"data-v-35822dd2",null).exports,d=s("Xxa5"),m=s.n(d),u=s("exGp"),p=s.n(u),h=s("KvPw"),v=s.n(h),f=(s("9BHd"),s("fhbW")),g={props:["param1"],components:{},name:"plugin",data:function(){return{icon:f.b,label:"Not implemented yet",title:"Not implemented yet",name:this.$options._componentTag}},computed:{isActive:function(){return!1}},methods:{onClickCallback:function(){alert("To be implemented")}}},_={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"plugin plugin-abstract",class:this.name},[e("span",{staticClass:"plugin-toolbar-btn",class:{active:this.isActive},attrs:{title:this.title},on:{click:this.onClickCallback}},[e("font-awesome-icon",{attrs:{icon:this.icon}})],1)])},staticRenderFns:[]};var y=s("VU/8")(g,_,!1,function(t){s("bTs0")},"data-v-2b2e55e5",null).exports,b={extends:y,name:"plugin-sticky",data:function(){return{icon:f.a,title:this.$t("plugins.sticky.title"),sticky:this.param1}},computed:{isActive:function(){return 1===this.sticky}},methods:{onClickCallback:function(){1===this.sticky?this.sticky=0:this.sticky=1,this.$emit("interface",this.sticky)}}};var C=s("VU/8")(b,null,!1,function(t){s("HtCJ")},null,null).exports,k={extends:y,name:"plugin-poll",data:function(){return{icon:f.c,activePluginComponent:"",title:this.$t("plugins.poll.title"),editPoll:this.param1}},computed:{isActive:function(){return!!this.editPoll}},methods:{onClickCallback:function(){this.activePluginComponent="PluginPollCreator",this.$emit("interface",this.activePluginComponent)}},mounted:function(){}};var w=s("VU/8")(k,null,!1,function(t){s("CubC")},null,null).exports,x=s("u4Bf"),$={name:"plugin-poll-creator",components:{draggable:s.n(x).a},props:{savePollUrl:{type:String},demo:{type:Boolean,default:!1},param1:{type:Object,default:null}},data:function(){return{poll:{question:"",answers:[{value:0,text:""},{value:1,text:""},{value:2,text:""}],multiple:!1},isValid:!1,success:null,editPoll:null,endDate:null}},mounted:function(){this.param1&&(this.poll=this.param1,this.endDate=this.param1.endDate?this.param1.endDate:null,this.editPoll=this.poll),0===this.poll.answers.length&&this.addEntry("")},methods:{addEntry:function(t){var e=Math.max.apply(Math,this.poll.answers.map(function(t){return t.value}));this.poll.answers.push({value:e+1,text:t})},createNewInput:function(t,e){this.poll.answers.length-1===t&&(e||this.poll.answers[t].text)&&this.addEntry("")},deleteInput:function(t){(t>0||this.poll.answers.length>1)&&this.poll.answers.splice(t,1)},nextInput:function(t){var e=this;this.poll.answers.length-1===t&&this.createNewInput(t,!0),setTimeout(function(){e.$refs.PollAnswerOptions[t+1].focus()},10)},closePoll:function(){this.$root.$emit("plugins:poll:creator:close"),this.$emit("dialogClose")},deletePoll:function(){this.$root.$emit("plugins:poll:creator:close"),this.$emit("dialogSubmit",null),this.closePoll()},createPoll:function(){if(this.validate(),this.isValid){this.poll.answers=this.poll.answers.filter(function(t){if(t.text.length>0)return t});var t={multiple:this.poll.multiple,question:this.poll.question,endDate:this.endDate,answers:[]};this.poll.answers.forEach(function(e,s){var i={value:e.value,text:e.text,votes:0,selected:!1};t.answers.push(i)}),this.$emit("dialogSubmit",t),this.$root.$emit("plugins:poll:creator:save",t),this.closePoll()}else this.alert(!1)},resetPoll:function(){this.poll.multiple=!1,this.poll.answers=[],this.addEntry(""),this.addEntry(""),this.addEntry(""),this.poll.question="",this.isValid=!1},validate:function(){var t=this.poll.answers.filter(function(t){if(t.text.length>0)return t}).length;return this.isValid=t>0,this.isValid},resetEndDate:function(){this.endDate=null},alert:function(t){var e=this;this.success=t,setTimeout(function(){e.success=null},3e3)}}},P={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"row poll-wrapper"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"row poll-title"},[s("div",{staticClass:"col-12"},[s("h4",[t._v(t._s(t.$t("plugins.poll.new_poll")))])])]),t._v(" "),s("div",{staticClass:"row poll-container"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"row poll-question"},[s("div",{staticClass:"col-10"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.poll.question,expression:"poll.question"}],attrs:{type:"text",placeholder:t.$t("plugins.poll.your_question")},domProps:{value:t.poll.question},on:{input:function(e){e.target.composing||t.$set(t.poll,"question",e.target.value)}}})])]),t._v(" "),s("div",{staticClass:"poll-answers"},[s("draggable",{attrs:{tag:"div",list:t.poll.answers,handle:".handle"}},t._l(t.poll.answers,function(e,i){return s("div",{key:e.value,staticClass:"row"},[s("div",{staticClass:"col-10"},[s("i",{staticClass:"handle"},[s("span")]),t._v(" "),s("span",{staticClass:"text"},[t._v(t._s(e.name)+" ")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.poll.answers[i].text,expression:"poll.answers[index].text"}],ref:"PollAnswerOptions",refInFor:!0,attrs:{placeholder:t.$t("plugins.poll.answer")+" "+(i+1),type:"text"},domProps:{value:t.poll.answers[i].text},on:{input:[function(e){e.target.composing||t.$set(t.poll.answers[i],"text",e.target.value)},function(e){t.createNewInput(i)}],focus:function(e){t.createNewInput(i)},keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.nextInput(i)}}})]),t._v(" "),s("div",{staticClass:"col-2"},[s("i",{staticClass:"close",on:{click:function(e){t.deleteInput(i)}}})])])}))],1),t._v(" "),s("div",{staticClass:"row poll-options"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"custom-control custom-checkbox"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.poll.multiple,expression:"poll.multiple"}],staticClass:"checked custom-control-input",attrs:{tabindex:"1",type:"checkbox",id:"cb-multiple-votes"},domProps:{checked:Array.isArray(t.poll.multiple)?t._i(t.poll.multiple,null)>-1:t.poll.multiple},on:{change:function(e){var s=t.poll.multiple,i=e.target,n=!!i.checked;if(Array.isArray(s)){var a=t._i(s,null);i.checked?a<0&&t.$set(t.poll,"multiple",s.concat([null])):a>-1&&t.$set(t.poll,"multiple",s.slice(0,a).concat(s.slice(a+1)))}else t.$set(t.poll,"multiple",n)}}}),t._v(" "),s("label",{staticClass:"custom-control-label",attrs:{for:"cb-multiple-votes"}},[t._v(t._s(t.$t("plugins.poll.allow_multiple_votes")))])])])]),t._v(" "),s("div",{staticClass:"row poll-options"},[s("div",{staticClass:"col-10"},[s("VueCtkDateTimePicker",{attrs:{tabindex:"1",locale:"$i18n.locale",label:t.$t("plugins.poll.pollEndDateLabel"),"button-now-translation":t.$t("plugins.poll.now")},model:{value:t.endDate,callback:function(e){t.endDate=e},expression:"endDate"}}),t._v(" "),s("small",{staticClass:"form-text text-muted"},[t._v(t._s(t.$t("plugins.poll.pollEndDateDescription")))])],1),t._v(" "),s("div",{staticClass:"col-2"})]),t._v(" "),s("div",{staticClass:"row poll-actions"},[s("div",{staticClass:"col-12"},[t.editPoll?s("button",{staticClass:"btn btn-outline-primary",attrs:{disabled:!t.validate()},on:{click:t.createPoll}},[t._v(t._s(t.$t("plugins.poll.save")))]):t._e(),t._v(" "),t.editPoll?t._e():s("button",{staticClass:"btn btn-outline-primary",attrs:{disabled:!t.validate()},on:{click:t.createPoll}},[t._v(t._s(t.$t("plugins.poll.create")))]),t._v(" "),s("button",{staticClass:"btn btn-outline-secondary",on:{click:t.closePoll}},[t._v(t._s(t.$t("plugins.poll.cancel")))]),t._v(" "),s("button",{staticClass:"btn btn-outline-danger",attrs:{disabled:!t.editPoll},on:{click:t.deletePoll}},[t._v(t._s(t.$t("plugins.poll.delete")))])])])])])])])},staticRenderFns:[]};var D=s("VU/8")($,P,!1,function(t){s("lzCO")},"data-v-40192cc4",null).exports,j=s("Ve+4"),z=s.n(j),O={api:{apiInitUrl:"/api/v2.0/nm_stream/node/%node/initialize",apiPollUpdateUrl:"/api/v2.0/nm_stream/node/%node/poll_update/%offset/%limit/%token",apiPostAttachmentDeleteUrl:"/api/v2.0/nm_stream/node/%node/file/%file/delete/%token",apiPostAttachmentUploadUrl:"/api/v2.0/nm_stream/node/%node/file/upload/%token",apiPostUpdateUrl:"/api/v2.0/nm_stream/node/%node/update/%token",apiPostAddUrl:"/api/v2.0/nm_stream/node/add/%token",apiPostDeleteUrl:"/api/v2.0/nm_stream/node/%node/delete/%token",apiCommentUpdateUrl:"/api/v2.0/nm_stream/comment/%comment/update/%token",apiCommentAddUrl:"/api/v2.0/nm_stream/node/%node/comment/add/%token",apiCommentDeleteUrl:"/api/v2.0/nm_stream/comment/%comment/delete/%token",apiNodePollAddVote:"/api/v2.0/nm_stream/node/%node/poll/add_vote/%token",apiUserMentionMembers:"/api/v2.0/nm_stream/node/%node/get/mention_members"}},U={getMentionMembers:function(t){var e=this;return p()(m.a.mark(function s(){var n,a,o;return m.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return n=O.api.apiUserMentionMembers.replace("%node",t),a={},s.next=4,i.a.axios.post(n,a,{withCredentials:!0});case 4:if(1!==(o=s.sent).data.status){s.next=9;break}return s.abrupt("return",o.data.mention_members);case 9:alert(e.$t("warning.error_occured_please_repeat_your_action"));case 10:case"end":return s.stop()}},s,e)}))()}},L={props:["streamOptions","editPost"],name:"stream-post-form",components:{vueDropzone:v.a,PluginSticky:C,PluginPoll:w,PluginPollCreator:D,AtTa:z.a},methods:{resizeTextarea:function(t){this.resizeTextareaElement(t.target),this.resizePostFormContainer()},resizePostFormContainer:function(){if(this.editPost&&this.$refs.vueDropZone){var t=parseFloat(this.$refs.vueDropZone.$el.style.height),e=0;this.$refs.postAttachmentList&&(e=parseFloat(this.$refs.postAttachmentList.clientHeight)),this.$parent.$el.querySelector(".stream-post").style.height=170+t+e+this.$el.querySelector("textarea").scrollHeight+"px"}this.currentPluginTemplate&&(this.$parent.$el.querySelector(".stream-post").style.height=90+this.$el.querySelector(".active-plugin-content").offsetHeight+"px")},resizeTextareaElement:function(t){t.style.height="auto",t.style.height=t.scrollHeight+"px"},savePost:function(){var t=this;this.busyLoading=!0;var e=this,s={};if(s.body=this.bodyText,s.privacy=this.privacyValue.value,s.sticky=this.stickyValue,s.poll=this.poll?this.poll:void 0,this.editPost){var n=this.$config.get("api.apiPostUpdateUrl").replace("%node",this.editPost.nid).replace("%token",this.streamOptions.token);i.a.axios.post(n,s,{withCredentials:!0}).then(function(s){if(1===s.data.status){e.editPost.body=s.data.nodeData.body,e.editPost.body_formatted=s.data.nodeData.body_formatted,e.editPost.privacy.privacyDefault=s.data.nodeData.privacy.privacyDefault,e.editPost.sticky=s.data.nodeData.sticky,e.editPost.poll=s.data.nodeData.poll;var i=new Event("nm-stream:update-model");document.dispatchEvent(i),e.$refs.vueDropZone.getQueuedFiles().length>0?(e.dropzoneResetAfterComplete=!0,e.$refs.vueDropZone.processQueue()):e.resetForm()}else alert(t.$t("warning.error_occured_please_repeat_your_action"))})}else{var a=this.$config.get("api.apiPostAddUrl").replace("%token",this.streamOptions.token);s.containerNID=this.streamOptions.containerNID,s.contextNID=this.streamOptions.contextNID,i.a.axios.post(a,s,{withCredentials:!0}).then(function(s){if(1===s.data.status){var i=s.data.nodeData;e.$emit("stream-post-added",i),e.$refs.vueDropZone.getQueuedFiles().length>0?(e.$refs.vueDropZone.setOption("url",e.getPostUploadUrl(i)),e.dropzoneResetAfterComplete=!0,e.$refs.vueDropZone.processQueue()):e.resetForm()}else alert(t.$t("warning.error_occured_please_repeat_your_action"))})}},escPressed:function(){0===this.bodyText.length&&this.resetForm()},submitOnCtrlEnter:function(t){t.ctrlKey&&this.savePost()},resetForm:function(){if(this.editPost)this.$emit("form-edit-canceled"),this.$parent.$el.querySelector(".stream-post").style.height="auto";else{this.formActive=!1,this.bodyText="";var t=parseInt(this.privacyDefault);this.privacyValue=i.a._.filter(this.privacyOptions,["value",t])[0],this.$el.querySelector("textarea.stream-post-body").blur(),this.$el.querySelector("textarea.stream-post-body").style.height="auto",this.stickyValue=0,this.poll=null}this.$refs.vueDropZone.removeAllFiles(),this.busyLoading=!1},dragOver:function(t){var e=this;this.formActive=!0,this.$nextTick(function(){e.resizeDropArea()})},queueCompleted:function(){this.dropzoneQueueProcessing&&(this.resetForm(),this.dropzoneResetAfterComplete=!1,this.dropzoneQueueProcessing=!1)},dropzoneQueueProcess:function(){this.dropzoneQueueProcessing=!0},resizeDropArea:function(){this.$refs.vueDropZone&&"250px"!==this.$refs.vueDropZone.$el.style.height&&(this.$refs.vueDropZone.$el.style.height="250px",this.$refs.vueDropZone.$el.querySelector("div.dz-message").style.marginTop="100px",this.resizePostFormContainer())},updateAuthor:function(){this.author=this.streamOptions.loggedInUser,this.editPost&&(this.author=this.editPost.user)},loadPrivacyOptions:function(t){var e=[];return Array.isArray(t)&&Array.isArray(this.streamOptions.privacyOptions)?(this.streamOptions.privacyOptions.forEach(function(s){t.indexOf(s.value)>-1&&e.push(s)}),e):e},initializePost:function(){var t=this;if(this.editPost){this.formActive=!0,this.bodyText=this.editPost.body,this.stickyValue=parseInt(this.editPost.sticky),this.poll=this.editPost.poll,this.privacyDefault=this.editPost.privacy.privacyDefault,this.privacyOptions=this.loadPrivacyOptions(this.editPost.privacy.privacyOptions);var e=parseInt(this.privacyDefault);this.privacyValue=i.a._.filter(this.privacyOptions,["value",e])[0],this.$nextTick(function(){t.resizeTextareaElement(t.$el.querySelector("textarea")),t.$refs.vueDropZone.$el.style.height="50px",t.$refs.vueDropZone.$el.querySelector("div.dz-message").style.marginTop="10px",t.resizePostFormContainer()})}},getPostUploadUrl:function(t){return t||(t=this.editPost),t?this.$config.get("api.apiPostAttachmentUploadUrl").replace("%node",t.nid).replace("%token",this.streamOptions.token):this.$config.get("api.apiPostAttachmentUploadUrl").replace("%node",0).replace("%token",this.streamOptions.token)},getAutoProcessQueue:function(){return!1},getDropZomeRemoveLabel:function(){return this.editPost?this.$t("label.nmDictHideFile"):this.$t("label.dictRemoveFile")},onAttachmentDeleteConf:function(t){this.$emit("post-form-onAttachmentDeleteConf",t)},pluginSubmitDialog:function(t){this.poll=t,this.pluginCloseDialog()},pluginCloseDialog:function(){var t=this;this.currentPluginTemplate="",this.$nextTick(function(){t.resizeTextareaElement(t.$el.querySelector("textarea"))})}},watch:{},mounted:function(){var t=p()(m.a.mark(function t(){var e,s=this;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.privacyDefault=this.streamOptions.privacyDefault,this.privacyOptions=this.streamOptions.privacyOptions,this.loggedInUser=this.streamOptions.loggedInUser,this.$nextTick(function(){s.$el.setAttribute("style","height:"+s.$el.scrollHeight+"px;overflow-y:hidden;"),s.$el.addEventListener("input",s.resizeTextarea)}),this.privacyValue||(this.editPost?(this.privacyOptions=this.loadPrivacyOptions(this.editPost.privacy.privacyOptions),this.privacyDefault=this.editPost.privacy.privacyDefault):(this.privacyOptions=this.streamOptions.privacyOptions,this.privacyDefault=this.streamOptions.privacyDefault),e=parseInt(this.privacyDefault),this.privacyValue=i.a._.filter(this.privacyOptions,["value",e])[0]),this.loggedInUser=this.streamOptions.loggedInUser,this.updateAuthor(),t.next=9,U.getMentionMembers(this.streamOptions.contextNID);case 9:this.mentionMembers=t.sent;case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),beforeDestroy:function(){this.$el.removeEventListener("input",this.resizeTextarea)},render:function(){return this.$slots.default[0]},data:function(){return{currentPluginTemplate:"",loggedInUser:null,author:null,privacyOptions:null,privacyDefault:null,formActive:!1,bodyText:"",poll:null,privacyValue:null,stickyValue:0,dropzoneResetAfterComplete:!1,files:null,busyLoading:!1,busyLoadingColor:"#888",busyLoadingSize:"10px",dropzoneQueueProcessing:!1,mentionMembers:null,dropzoneOptions:{url:this.getPostUploadUrl(),createImageThumbnails:!1,autoProcessQueue:this.getAutoProcessQueue(),addRemoveLinks:!0,acceptedFiles:this.streamOptions.acceptedFiles,maxFilesize:20,dictDefaultMessage:this.$t("label.dictDefaultMessage"),dictFallbackMessage:this.$t("label.dictFallbackMessage"),dictFileTooBig:this.$t("label.customdictFileTooBig"),dictInvalidFileType:this.$t("label.dictInvalidFileType"),dictCancelUpload:this.$t("label.dictCancelUpload"),dictUploadCanceled:this.$t("label.dictUploadCanceled"),dictCancelUploadConfirmation:this.$t("label.dictCancelUploadConfirmation"),dictRemoveFile:this.getDropZomeRemoveLabel(),dictMaxFilesExceeded:this.$t("label.dictMaxFilesExceeded")}}},computed:{canSetSticky:function(){return this.editPost?this.editPost.permissions.canSetSticky:this.streamOptions.permissions.canCreateStickyPost}}},A={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"stream-post-from card",on:{dragover:t.dragOver}},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-2"},[s("transition",{attrs:{name:"fade"}},[t.formActive?s("img",{key:t.formActive,staticClass:"card-img-top rounded-circle",attrs:{src:t.author.avatarUrl,title:t.author.name}}):t._e()])],1),t._v(" "),t.currentPluginTemplate?s("div",{staticClass:"active-plugin-content col-10"},[s("keep-alive",[s(t.currentPluginTemplate,{tag:"component",attrs:{param1:t.poll},on:{dialogSubmit:function(e){t.pluginSubmitDialog(e)},dialogClose:function(e){t.pluginCloseDialog()}}})],1)],1):t._e(),t._v(" "),t.currentPluginTemplate?t._e():s("div",{staticClass:"col-10"},[s("at-ta",{attrs:{members:t.mentionMembers,"name-key":"name"},scopedSlots:t._u([{key:"item",fn:function(e){return[s("img",{staticClass:"rounded-circle",attrs:{src:e.item.avatar}}),t._v(" "),s("span",{domProps:{textContent:t._s(e.item.realname)}})]}}])},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.bodyText,expression:"bodyText"},{name:"model",rawName:"v-model.lazy",value:t.bodyText,expression:"bodyText",modifiers:{lazy:!0}}],staticClass:"stream-post-body",attrs:{name:"body",disabled:t.busyLoading,placeholder:t.$t("placeholder.your_post_message")},domProps:{value:t.bodyText,value:t.bodyText},on:{keyup:[function(e){return"button"in e||!t._k(e.keyCode,"esc",27,e.key,"Escape")?t.escPressed(e):null},function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.submitOnCtrlEnter(e):null}],focus:function(e){t.formActive=!0},input:function(e){e.target.composing||(t.bodyText=e.target.value)},change:function(e){t.bodyText=e.target.value}}})]),t._v(" "),t.formActive?s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 plugins"},[t.canSetSticky?s("plugin-sticky",{attrs:{param1:t.stickyValue},on:{interface:function(e){t.stickyValue=e}}}):t._e(),t._v(" "),s("plugin-poll",{attrs:{param1:t.poll},on:{interface:function(e){t.currentPluginTemplate=e}}})],1)]):t._e(),t._v(" "),s("div",{staticClass:"row stream-action-1"},[s("transition",{attrs:{name:"fade"}},[t.formActive?s("div",{key:t.formActive,staticClass:"col-12 stream-attachments"},[s("vue-dropzone",{ref:"vueDropZone",attrs:{id:"dropzone",options:t.dropzoneOptions,disabled:t.busyLoading},on:{"vdropzone-processing":t.dropzoneQueueProcess,"vdropzone-file-added":t.resizeDropArea,"vdropzone-queue-complete":t.queueCompleted}}),t._v(" "),t.editPost&&t.editPost.attachments.length>0?s("div",{ref:"postAttachmentList",staticClass:"stream-post-attachments"},[s("font-awesome-icon",{attrs:{icon:["far","file"]}}),t._v("\n              "+t._s(t.$t("label.attachments"))+"\n              "),t._l(t.editPost.attachments,function(e){return s("div",{key:e.fid},[s("span",{domProps:{innerHTML:t._s(e.download_link)}}),t._v(" "),e.permissions.canDelete?s("a",{staticClass:"attachment-trash-delete",attrs:{href:"#",title:t.$t("button.delete_attachment")},on:{click:function(s){s.preventDefault(),t.onAttachmentDeleteConf(e)}}},[s("font-awesome-icon",{attrs:{icon:["far","trash-alt"]}})],1):t._e()])})],2):t._e(),t._v(" "),s("pulse-loader",{attrs:{loading:t.busyLoading,color:t.busyLoadingColor,size:t.busyLoadingSize}})],1):t._e()])],1),t._v(" "),s("div",{staticClass:"row stream-action-2"},[s("div",{staticClass:"col-12"},[s("div",{staticClass:"row"},[s("transition",{attrs:{name:"fade"}},[t.formActive?s("div",{key:t.formActive,staticClass:"col-12 action-buttons"},[t.privacyOptions.length>0?s("div",{staticClass:"stream-post-privacy-settings"},[s("multiselect",{attrs:{options:t.privacyOptions,"track-by":"value","option-height":104,searchable:!1,"show-labels":!1,"allow-empty":!1,placeholder:t.$t("button.select_privacy"),disabled:t.busyLoading},scopedSlots:t._u([{key:"singleLabel",fn:function(e){return[s("img",{staticClass:"option__image",attrs:{src:e.option.img,alt:e.option.title}}),t._v(" "),s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[t._v(t._s(e.option.title))])])]}},{key:"option",fn:function(e){return[s("img",{staticClass:"option__image",attrs:{src:e.option.img,alt:e.option.title,disabled:t.busyLoading}}),t._v(" "),s("div",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[t._v(t._s(e.option.title))]),s("span",{staticClass:"option__small"},[t._v(t._s(e.option.desc))])])]}}]),model:{value:t.privacyValue,callback:function(e){t.privacyValue=e},expression:"privacyValue"}})],1):t._e(),t._v(" "),s("button",{staticClass:"btn btn-outline-primary stream-post-post float-right",attrs:{disabled:this.bodyText.length<1||t.busyLoading},on:{click:t.savePost}},[t._v(t._s(t.$t("button.post")))]),t._v(" "),s("button",{staticClass:"btn btn-outline-secondary stream-post-cancel float-right",attrs:{disabled:t.busyLoading},on:{click:t.resetForm}},[t._v(t._s(t.$t("button.cancel")))])]):t._e()])],1)])])],1)])])},staticRenderFns:[]};var S=s("VU/8")(L,A,!1,function(t){s("7UhR"),s("GgjP")},"data-v-dbdeb74c",null).exports,F={name:"plugin-poll-view",props:{question:{type:String,required:!0},answers:{type:Array,required:!0},showResults:{type:Boolean,default:!1},showTotalVotes:{type:Boolean,default:!0},finalResults:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},submitButtonText:{type:String,default:function(){return this.$t("plugins.poll.submit")}},customId:{type:Number,default:0}},data:function(){return{visibleResults:JSON.parse(this.showResults)}},computed:{totalVotes:function(){var t=0;return this.answers.filter(function(e){!isNaN(e.votes)&&e.votes>0&&(t+=parseInt(e.votes))}),t},totalVotesFormatted:function(){return this.totalVotes.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},labelVotes:function(){return 1===this.totalVotes?this.$t("plugins.poll.vote"):this.$t("plugins.poll.votes")},mostVotes:function(){var t=0;return this.answers.filter(function(e){!isNaN(e.votes)&&e.votes>0&&e.votes>=t&&(t=e.votes)}),t},calcAnswers:function(){var t=this;return 0===this.totalVotes?this.answers.map(function(t){return t.percent="0%",t}):this.answers.filter(function(e){return!isNaN(e.votes)&&e.votes>0?e.percent=Math.round(parseInt(e.votes)/t.totalVotes*100)+"%":e.percent="0%",e})},totalSelections:function(){return this.calcAnswers.filter(function(t){return t.selected}).length}},methods:{handleMultiple:function(){var t=[];this.calcAnswers.filter(function(e){e.selected&&(e.votes++,t.push({value:e.value,votes:e.votes}))}),this.visibleResults=!0;var e={arSelected:t,totalVotes:this.totalVotes};this.customId&&(e.customId=this.customId),this.$emit("addvote",e)},handleVote:function(t){if(this.multiple)return void 0===t.selected&&console.log("Please add 'selected: false' on the answer object"),void(t.selected=!t.selected);t.votes++,t.selected=!0,this.visibleResults=!0;var e={value:t.value,votes:t.votes,totalVotes:this.totalVotes};this.customId&&(e.customId=this.customId),this.$emit("addvote",e)}}},T={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"vue-poll"},[s("h4",{staticClass:"qst",domProps:{innerHTML:t._s(t.question)}}),t._v(" "),s("div",{staticClass:"ans-cnt"},t._l(t.calcAnswers,function(e,i){return s("div",{key:i,class:(n={ans:!0},n[e.custom_class]=e.custom_class,n)},[t.finalResults?[s("div",{staticClass:"ans-voted final"},[e.percent?s("span",{staticClass:"percent",domProps:{textContent:t._s(e.percent)}}):t._e(),t._v(" "),s("span",{staticClass:"txt",domProps:{innerHTML:t._s(e.text)}})]),t._v(" "),s("span",{class:{bg:!0,selected:t.mostVotes==e.votes},style:{width:e.percent}})]:[t.visibleResults?s("div",{class:{"ans-voted":!0,selected:e.selected}},[e.percent?s("span",{staticClass:"percent",domProps:{textContent:t._s(e.percent)}}):t._e(),t._v(" "),s("span",{staticClass:"txt",domProps:{innerHTML:t._s(e.text)}})]):s("div",{class:{"ans-no-vote noselect":!0,active:e.selected},on:{click:function(s){s.preventDefault(),t.handleVote(e)}}},[s("span",{staticClass:"txt",domProps:{innerHTML:t._s(e.text)}})]),t._v(" "),s("span",{staticClass:"bg",style:{width:t.visibleResults?e.percent:"0%"}})]],2);var n})),t._v(" "),t.showTotalVotes&&(t.visibleResults||t.finalResults)?s("div",{staticClass:"votes",domProps:{textContent:t._s(t.totalVotesFormatted+" "+t.labelVotes)}}):t._e(),t._v(" "),!t.finalResults&&!t.visibleResults&&t.multiple&&t.totalSelections>0?[s("button",{staticClass:"btn btn-primary submit-button",attrs:{href:"#"},domProps:{textContent:t._s(t.submitButtonText)},on:{click:function(e){return e.preventDefault(),t.handleMultiple(e)}}})]:t._e()],2)},staticRenderFns:[]};var E={addVote:function(t,e,s){var n=this;return p()(m.a.mark(function a(){var o,r,l,c;return m.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return o={arSelected:[]},e.arSelected?o.arSelected=e.arSelected:o.arSelected=[{value:e.value,votes:e.votes}],r=O.api.apiNodePollAddVote.replace("%node",t).replace("%token",s),l=o.arSelected,a.next=6,i.a.axios.post(r,l,{withCredentials:!0});case 6:if(1!==(c=a.sent).data.status){a.next=11;break}return a.abrupt("return",c.data);case 11:alert(n.$t("warning.error_occured_please_repeat_your_action"));case 12:case"end":return a.stop()}},a,n)}))()}},V={props:["streamOptions","post","comments"],components:{StreamComment:c,StreamCommentForm:o,StreamPostForm:S,PluginPollView:s("VU/8")(F,T,!1,function(t){s("SKJB")},null,null).exports},name:"stream-post",data:function(){return{pollViewRenderOnceKey:1,initializeForm:!1,showComments:!1,curDeleteAttachment:null,streamPostFormComponent:""}},computed:{canEdit:function(){return this.post.permissions.canEdit},canDelete:function(){return this.post.permissions.canDelete},canCreateComment:function(){return!0},sortedComments:function(){return i.a._.orderBy(this.comments,"created","desc")},modalID:function(){return"modal-delete"+this.post.nid},privacy:function(){var t=parseInt(this.post.privacy.privacyDefault);return i.a._.filter(this.streamOptions.privacyOptionsAll,["value",t])[0]},streamLink:function(){return this.post.container.link+"?streamNode="+this.post.nid}},mounted:function(){var t=this;this.$root.$on("plugins:poll:creator:save",function(){t.pollViewRenderOnceKey++})},methods:{editPost:function(t){var e=this;this.initializeForm=!0,this.showComments=!1,this.$el.classList.add("flip-active"),setTimeout(function(){e.$refs.streamPostForm.initializePost()},200),this.$refs.backDelete.classList.add("hide"),this.$refs.backEdit.classList.remove("hide")},toggleComments:function(t){this.showComments=!this.showComments,this.showComments&&this.$nextTick(function(){var t=new Event("nm-stream:update");document.dispatchEvent(t)})},deletePost:function(t){var e=this;this.showComments=!1,setTimeout(function(){e.$el.classList.add("flip-active"),e.$refs.backEdit.classList.add("hide"),e.$refs.backDelete.classList.remove("hide")},200)},editCanceled:function(t){this.$el.classList.remove("flip-active")},onDeleteSubmit:function(){var t=this,e=this,s=this.$config.get("api.apiPostDeleteUrl").replace("%node",this.post.nid).replace("%token",this.streamOptions.token);i.a.axios.get(s,{withCredentials:!0}).then(function(s){1===s.data.status?(e.$emit("stream-post-deleted",e.post),t.$el.classList.remove("flip-active")):alert(t.$t("warning.error_occured_please_repeat_your_action"))})},onDeleteCancel:function(){this.$el.classList.remove("flip-active")},onAttachmentDeleteConf:function(t){this.$refs.postDeleteAttachmentConf.show(),this.curDeleteAttachment=t},addUser:function(t){this.$emit("stream-user-added",t)},addComment:function(t){this.showComments=!0,this.$emit("stream-comment-added",t)},deleteComment:function(t){this.$emit("stream-comment-deleted",t)},hideModal:function(){this.$refs.postDeleteAttachmentConf.hide(),this.curDeleteAttachment=null},onAttachmentDelete:function(){var t=this.curDeleteAttachment,e=this,s=this.$config.get("api.apiPostAttachmentDeleteUrl").replace("%node",e.post.nid).replace("%file",t.fid).replace("%token",this.streamOptions.token);i.a.axios.get(s,{withCredentials:!0}).then(function(s){var i=e.post.attachments.findIndex(function(e){return e.fid===t.fid});e.post.attachments.splice(i,1)}),this.hideModal()},pollAddVote:function(t){E.addVote(this.post.nid,t,this.streamOptions.token)}},watch:{initializeForm:function(t,e){!0===t&&(this.streamPostFormComponent="StreamPostForm")}}},I={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"card-flip"},[s("div",{staticClass:"flip"},[s("div",{staticClass:"front"},[s("div",{staticClass:"stream-post card"},[this.streamOptions.containerNID!==this.post.container.nid?s("div",{staticClass:"row post-context"},[s("div",{staticClass:"col-12"},[s("span",{staticClass:"float-right"},[t._v(" "+t._s(t.$t("label.postContextFrom"))+": "),s("a",{attrs:{href:t.streamLink}},[t._v(t._s(this.post.container.title))])])])]):t._e(),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-2"},[s("img",{staticClass:"card-img-top rounded-circle",attrs:{src:t.post.user.avatarUrl,title:t.post.user.name}})]),t._v(" "),s("div",{staticClass:"col-10"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 post-header"},[null!==this.privacy?s("div",{staticClass:"post-privacy-wrapper float-right"},[s("img",{staticClass:"post-privacy",attrs:{src:t.privacy.img,alt:t.privacy.title,title:t.privacy.title}})]):t._e(),t._v(" "),t.canEdit||t.canDelete?s("div",[s("b-dropdown",{staticClass:"post-actions-dropdown m-md-2 float-right",attrs:{text:"...",offset:"-120"}},[t.canEdit?s("b-dropdown-item",{on:{click:t.editPost}},[t._v(t._s(t.$t("button.edit")))]):t._e(),t._v(" "),t.canDelete?s("b-dropdown-item",{on:{click:t.deletePost}},[t._v(t._s(t.$t("button.delete")))]):t._e()],1)],1):t._e(),t._v(" "),s("div",{staticClass:"username"},[s("a",{attrs:{href:t.post.user.profileUrl}},[t._v(t._s(t.post.user.name))])]),t._v(" "),s("div",{staticClass:"created"},[s("font-awesome-icon",{attrs:{icon:["far","clock"]}}),s("span",{attrs:{title:t._f("moment")(t.post.created,"L LT")}},[t._v(" "+t._s(t._f("moment")(t.post.created,"from"))+"\n                    ")])],1)])]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12 body"},[s("p",{attrs:{tag:"p"},domProps:{innerHTML:t._s(t.post.body_formatted)}}),t._v(" "),t.post.poll?s("plugin-poll-view",t._b({key:t.pollViewRenderOnceKey,on:{addvote:t.pollAddVote}},"plugin-poll-view",t.post.poll,!1)):t._e()],1),t._v(" "),1==t.post.sticky?s("div",{staticClass:"post-sticky",attrs:{title:t.$t("plugins.sticky.status_title")}},[s("font-awesome-icon",{attrs:{icon:["fa","anchor"]}})],1):t._e()]),t._v(" "),s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[t.post.attachments.length>0?s("div",{staticClass:"stream-post-attachments"},[s("font-awesome-icon",{attrs:{icon:["far","file"]}}),t._v(" "+t._s(t.$t("label.attachments"))+"\n                  "),s("ul",t._l(t.post.attachments,function(e){return s("li",{key:e.fid},[s("span",{domProps:{innerHTML:t._s(e.download_link)}}),t._v(" "),e.permissions.canDelete?s("a",{staticClass:"attachment-trash-delete",attrs:{href:"#",title:t.$t("button.delete_attachment")},on:{click:function(s){s.preventDefault(),t.onAttachmentDeleteConf(e)}}},[s("font-awesome-icon",{attrs:{icon:["far","trash-alt"]}})],1):t._e()])}))],1):t._e(),t._v(" "),t.sortedComments.length>0?s("div",{staticClass:"stream-post-footer"},[s("div",[s("transition",{attrs:{name:"slide-fade"}},[t.showComments?s("a",{key:"false",attrs:{href:"#"},on:{click:function(e){e.preventDefault(),t.showComments=!t.showComments}}},[t._v(t._s(t.$t("link.hide_x_comments",{count:t.sortedComments.length})))]):s("a",{key:"true",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.toggleComments(e)}}},[t._v("\n                        "+t._s(t.$t("link.show_x_comments",{count:t.sortedComments.length}))+"\n                      ")])])],1)]):t._e()])])])]),t._v(" "),s("div",{staticClass:"row comments-wrapper"},[s("div",{staticClass:"col-10 offset-2"},[t.canCreateComment?s("stream-comment-form",{attrs:{streamOptions:t.streamOptions,post:t.post},on:{"stream-user-added":t.addUser,"stream-comment-added":t.addComment}}):t._e(),t._v(" "),s("transition",{attrs:{name:"fade"}},[t.sortedComments.length>0&&!0===t.showComments?s("div",[s("transition-group",{attrs:{name:"list"}},t._l(t.sortedComments,function(e){return s("stream-comment",{key:e.cid,attrs:{streamOptions:t.streamOptions,comment:e,user:e.user},on:{"stream-comment-deleted":t.deleteComment}})}))],1):t._e()])],1)])])]),t._v(" "),s("div",{ref:"backEdit",staticClass:"back-edit"},[s("div",{staticClass:"stream-post card"},[s(t.streamPostFormComponent,{ref:"streamPostForm",tag:"component",attrs:{streamOptions:t.streamOptions,editPost:t.post},on:{"form-edit-canceled":function(e){t.editCanceled()},"post-form-onAttachmentDeleteConf":t.onAttachmentDeleteConf}})],1)]),t._v(" "),s("div",{ref:"backDelete",staticClass:"back-delete"},[s("div",{staticClass:"stream-post card"},[s("h3",[t._v(t._s(t.$t("warning.delete_post_really_want_to")))]),t._v(" "),s("br"),t._v(" "),s("p",[t._v("\n          "+t._s(t.$t("warning.delete_post_action_cannot_be_undone"))+"\n        ")]),t._v(" "),s("br"),t._v(" "),s("div",{staticClass:"float-right"},[s("button",{staticClass:"btn btn-outline-danger float-right",on:{click:t.onDeleteSubmit}},[t._v(t._s(t.$t("button.delete")))]),t._v(" "),s("button",{staticClass:"btn btn-outline-secondary float-right",on:{click:t.onDeleteCancel}},[t._v(t._s(t.$t("button.cancel")))])])])])]),t._v(" "),s("b-modal",{ref:"postDeleteAttachmentConf",attrs:{"hide-footer":"",title:t.$t("label.attachment_delete")}},[s("div",{staticClass:"d-block text-center"},[t._v("\n      "+t._s(t.$t("warning.delete_attachment_really_want_to"))+"\n    ")]),t._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"",block:""},on:{click:t.hideModal}},[t._v(t._s(t.$t("button.cancel")))]),t._v(" "),s("b-button",{staticClass:"mt-3",attrs:{variant:"outline-danger",block:""},on:{click:function(e){t.onAttachmentDelete()}}},[t._v(t._s(t.$t("button.delete")))])],1)],1)},staticRenderFns:[]};var N=s("VU/8")(V,I,!1,function(t){s("4KCC"),s("JWrn")},"data-v-e1b629c0",null).exports,M=s("Zrlr"),R=s.n(M),q=function t(){R()(this,t),this.privacyDefault="",this.privacyOptions=[],this.privacyOptionsAll=[],this.permissions=[],this.loggedInUser="",this.containerNID="",this.contextNID="",this.token="",this.timestamp="",this.acceptedFiles=""},B={name:"stream",components:{StreamPostForm:S,StreamPost:N,StreamComment:c},data:function(){return{posts:[],streamOptions:[],comments:[],users:[],busyLoadingMore:!1,busyLoadingColor:"#888",busyLoadingSize:"12px",maxPostsLimitReached:!1,loggedInUser:1,initialized:!1,infiniteScrollLimit:10,maxPostsToShow:10,pollingUpdate:null,containerNid:null,streamUpdateOnRerender:!1}},beforeMount:function(){this.$root.$el.attributes["data-container-nid"]&&(this.containerNid=this.$root.$el.attributes["data-container-nid"].value)},computed:{sortedPosts:function(){var t=i.a._.chain(this.posts).sortBy("created").sortBy("sticky").reverse().value();return t.slice(0,this.maxPostsToShow)}},methods:{initialize:function(){this.initializeStream()},addPost:function(t){this.posts.push(t);var e=new Event("nm-stream:update-model");document.dispatchEvent(e)},deletePost:function(t){var e=this.posts.indexOf(t);this.posts.splice(e,1);var s=new Event("nm-stream:update-model");document.dispatchEvent(s)},deleteComment:function(t){var e=this.comments.indexOf(t);this.comments.splice(e,1);var s=new Event("nm-stream:update-model");document.dispatchEvent(s)},addComment:function(t){this.comments.push(t);var e=new Event("nm-stream:update-model");document.dispatchEvent(e)},addUser:function(t){this.getUser(t.uid)||this.users.push(t)},initializeStream:function(){var t=this,e=this;i.a.axios.get(this.$config.get("api.apiInitUrl").replace("%node",this.containerNid),{withCredentials:!0}).then(function(s){e.posts=s.data.stream.posts,e.users=s.data.stream.users,e.comments=s.data.stream.comments,e.streamOptions=new q,e.streamOptions.privacyOptions=s.data.stream.privacyOptions,e.streamOptions.privacyOptionsAll=s.data.stream.privacyOptionsAll,e.streamOptions.privacyDefault=s.data.stream.privacyDefault,e.streamOptions.permissions=s.data.stream.permissions,e.streamOptions.loggedInUser=t.getUser(s.data.stream.loggedInUser),e.streamOptions.token=s.data.stream.token,e.streamOptions.contextNID=s.data.stream.contextNID,e.streamOptions.containerNID=s.data.stream.containerNID,e.streamOptions.timestamp=s.data.stream.timestamp,e.streamOptions.acceptedFiles=s.data.stream.acceptedFiles,e.streamPlugins=[],e.initialized=!0,document.addEventListener("nm-stream:update-model",function(e){t.streamUpdateOnRerender=!0},!1);var i=new Event("nm-stream:update-model");document.dispatchEvent(i),e.pollUpdate()})},loadMore:function(){if(!this.initialized||this.busyLoadingMore||this.maxPostsLimitReached)return!1;this.busyLoadingMore=!0,this.maxPostsToShow+=this.infiniteScrollLimit,this.pollUpdate()},getUser:function(t){return i.a._.find(this.users,["uid",t])},getNodeComments:function(t){var e=i.a._.filter(this.comments,["nid",t]);if(e.length>0)for(var s in e)e[s].user=this.getUser(e[s].uid);return e},getLoadedPost:function(t){return t.user=this.getUser(t.uid),t},pollUpdate:function(){var t=this,e=this;clearInterval(this.pollingUpdate),this.pollingUpdate=setInterval(function(){if(document.hasFocus()){var s=t.$config.get("api.apiPollUpdateUrl").replace("%node",t.streamOptions.containerNID).replace("%offset",0).replace("%limit",e.maxPostsToShow).replace("%token",e.streamOptions.token);i.a.axios.get(s,{withCredentials:!0}).then(function(t){e.busyLoadingMore&&(e.maxPostsLimitReached=e.posts.length>=t.data.stream.posts.length,e.busyLoadingMore=!1),e.posts=t.data.stream.posts,e.users=t.data.stream.users,e.comments=t.data.stream.comments,e.streamOptions.timestamp=t.data.stream.timestamp;var s=new Event("nm-stream:update-model");document.dispatchEvent(s)})}},5e3)},mergeByProperty:function(t,e,s){i.a._.each(e,function(e){var n=i.a._.find(t,function(t){return t[s]===e[s]});n?i.a._.extend(n,e):t.push(e)})}},updated:function(){var t=this;this.streamUpdateOnRerender&&this.$nextTick(function(){var e=new Event("nm-stream:update");document.dispatchEvent(e),t.streamUpdateOnRerender=!1})},mounted:function(){this.initialize(),window.addEventListener("dragover",function(t){(t=t||event).preventDefault()},!1),window.addEventListener("drop",function(t){(t=t||event).preventDefault()},!1)},beforeDestroy:function(){clearInterval(this.pollingUpdate)}},H={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"container",attrs:{id:"stream"}},[s("pulse-loader",{attrs:{loading:!t.initialized,color:t.busyLoadingColor,size:t.busyLoadingSize}}),t._v(" "),t.initialized&&t.streamOptions.containerNID>0&&t.streamOptions.permissions.canCreatePost?s("stream-post-form",{attrs:{streamOptions:t.streamOptions,streamPlugins:t.streamPlugins},on:{"stream-post-added":t.addPost}}):t._e(),t._v(" "),t.initialized&&0==t.posts.length?s("div",[t._v("\n    "+t._s(t.$t("empty.no_posts_found"))+"\n  ")]):t._e(),t._v(" "),s("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:t.loadMore,expression:"loadMore"},{name:"keep-scroll-position",rawName:"v-keep-scroll-position"}],staticClass:"stream-post-wrapper",attrs:{"infinite-scroll-disabled":"busyLoading","infinite-scroll-distance":"10"}},[s("transition-group",{attrs:{name:"list"}},t._l(t.sortedPosts,function(e){return s("stream-post",{key:e.nid,attrs:{post:t.getLoadedPost(e),comments:t.getNodeComments(e.nid),streamOptions:t.streamOptions},on:{"stream-post-deleted":t.deletePost,"stream-comment-deleted":t.deleteComment,"stream-comment-added":t.addComment,"stream-user-added":t.addUser}})}))],1),t._v(" "),s("br"),t._v(" "),s("pulse-loader",{attrs:{loading:t.busyLoadingMore,color:t.busyLoadingColor,size:t.busyLoadingSize}}),t._v(" "),s("br")],1)},staticRenderFns:[]};var Z=s("VU/8")(B,H,!1,function(t){s("t+4i"),s("jGJN")},"data-v-4ba71928",null).exports,K=s("e6fC"),Q=(s("tLvy"),s("NETs")),J=s.n(Q),W=s("RUzx"),X=s("C/JF"),G=s("Yu89"),Y=s("1e6/"),tt=s("TXmL"),et=s("UqSQ"),st=s.n(et),it=s("mtWM"),nt=s.n(it),at=s("Rf8U"),ot=s.n(at),rt=s("j93a"),lt=s.n(rt),ct=s("gf/g"),dt=s("bqTm"),mt=s.n(dt),ut=s("MVBf"),pt=s.n(ut),ht={name:"PulseLoader",props:{loading:{type:Boolean,default:!0},color:{type:String,default:"#5dc596"},size:{type:String,default:"15px"},margin:{type:String,default:"2px"},radius:{type:String,default:"100%"}},data:function(){return{spinnerStyle:{backgroundColor:this.color,width:this.size,height:this.size,margin:this.margin,borderRadius:this.radius,display:"inline-block",animationName:"v-pulseStretchDelay",animationDuration:"0.75s",animationIterationCount:"infinite",animationTimingFunction:"cubic-bezier(.2,.68,.18,1.08)",animationFillMode:"both"},spinnerDelay1:{animationDelay:"0.12s"},spinnerDelay2:{animationDelay:"0.24s"},spinnerDelay3:{animationDelay:"0.36s"}}}},vt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{directives:[{name:"show",rawName:"v-show",value:this.loading,expression:"loading"}],staticClass:"v-spinner"},[e("div",{staticClass:"v-pulse v-pulse1",style:[this.spinnerStyle,this.spinnerDelay1]}),e("div",{staticClass:"v-pulse v-pulse2",style:[this.spinnerStyle,this.spinnerDelay2]}),e("div",{staticClass:"v-pulse v-pulse3",style:[this.spinnerStyle,this.spinnerDelay3]})])},staticRenderFns:[]};var ft=s("VU/8")(ht,vt,!1,function(t){s("0eAL")},null,null).exports,gt=s("oUIx"),_t=s.n(gt);s("7w68");X.c.add(G.a,G.b,G.c,f.a,f.c),i.a.component("font-awesome-icon",Y.a),i.a.component("pulse-loader",ft),i.a.component("multiselect",W.Multiselect),i.a.config.productionTip=!1,i.a.use(K.a),i.a.use(J.a),i.a.use(tt.a),i.a.use(ot.a,nt.a),i.a.use(ct.a,{config:O}),i.a.use(mt.a),i.a.component("nl2br",lt.a),i.a.use(pt.a);var yt=s("PJh5");s("DOkx"),i.a.use(s("8AgW"),{moment:yt}),i.a.component("VueCtkDateTimePicker",_t.a);var bt=new tt.a({locale:"de",messages:st.a});window.stream=new i.a({i18n:bt,el:"#stream",components:{Stream:Z},template:'<stream ref="stream"></stream>',mounted:function(){},methods:{loadJsonSample:function(t){}}})},RvtP:function(t,e){},SKJB:function(t,e){},UqSQ:function(t,e){t.exports={de:{placeholder:{your_post_message:"Ihre Nachricht",your_comment_message:"Ihr Kommentar"},label:{attachments:"Anhänge",upload_files:"Dateien hochladen",attachment_delete:"Anhang löschen",dictDefaultMessage:"<i class='fa fa-cloud-upload'></i> Dateien hochladen",dictFallbackMessage:"Ihr Browser unterstützt leider keinen Upload",dictInvalidFileType:"Dieser Dateityp wird nicht unterstützt",dictCancelUpload:"Upload abbrechen",dictUploadCanceled:"Der Upload wurde abgebrochen",dictCancelUploadConfirmation:"Upload wirklich abbrechen?",dictRemoveFile:"Entfernen",customdictFileTooBig:"Diese Datei ist zu groß. Maximale Größe: {{maxFilesize}} MB.",nmDictHideFile:"Verstecken",dictMaxFilesExceeded:"Das Uploadlimit von {{maxFiles}} wurde überschritten",postContextFrom:"Beitrag aus"},link:{show_x_comments:"{count} Kommentare anzeigen",hide_x_comments:"{count} Kommentare verstecken"},button:{cancel:"Abbrechen",post:"Speichern",edit:"Bearbeiten",delete:"Löschen",select_privacy:"Sichtbarkeit festlegen",delete_attachment:"Anhang löschen"},warning:{delete_post_really_want_to:"Möchten Sie den Beitrag wirklich löschen?",delete_attachment_really_want_to:"Möchten Sie den Anhang wirklich löschen?",delete_post_action_cannot_be_undone:"Sie sind dabei einen Beitrag zu löschen. Diese Aktion kann nicht rückgängig gemacht werden.",delete_comment_really_want_to:"Möchten Sie den Kommentar wirklich löschen?",delete_comment_action_cannot_be_undone:"Sie sind dabei einen Kommentar zu löschen. Diese Aktion kann nicht rückgängig gemacht werden.",error_occured_please_repeat_your_action:"Es ist ein Fehler aufgetreten, bitte wiederholen Sie Ihre letzte Aktion."},empty:{no_posts_found:"Keine Beiträge"},plugins:{sticky:{title:"Beitrag anheften",status_title:"Beitrag angeheftet"},poll:{title:"Umfrage starten",new_poll:"Neue Umfrage starten",your_question:"Die Frage..",answer:"Antwort",allow_multiple_votes:"Mehrere Antworten erlauben",submit:"Abstimmen",save:"Speichern",create:"Erstellen",delete:"Löschen",cancel:"Abbrechen",status_created:"Erstellt",status_error:"Fehler",vote:"Stimme",votes:"Stimmen",now:"Jetzt",pollEndDateLabel:"Ende der Umfrage festlegen",pollEndDateDescription:"Wird dieses Feld gesetzt, so ist ab diesem Zeitpunkt keine Abstimmung mehr möglich. Es wird das Umfrageergebnis angezeigt."}}}}},bTs0:function(t,e){},jGJN:function(t,e){},lzCO:function(t,e){},"t+4i":function(t,e){},tLvy:function(t,e){},uslO:function(t,e,s){var i={"./af":"3CJN","./af.js":"3CJN","./ar":"3MVc","./ar-dz":"tkWw","./ar-dz.js":"tkWw","./ar-kw":"j8cJ","./ar-kw.js":"j8cJ","./ar-ly":"wPpW","./ar-ly.js":"wPpW","./ar-ma":"dURR","./ar-ma.js":"dURR","./ar-sa":"7OnE","./ar-sa.js":"7OnE","./ar-tn":"BEem","./ar-tn.js":"BEem","./ar.js":"3MVc","./az":"eHwN","./az.js":"eHwN","./be":"3hfc","./be.js":"3hfc","./bg":"lOED","./bg.js":"lOED","./bm":"hng5","./bm.js":"hng5","./bn":"aM0x","./bn.js":"aM0x","./bo":"w2Hs","./bo.js":"w2Hs","./br":"OSsP","./br.js":"OSsP","./bs":"aqvp","./bs.js":"aqvp","./ca":"wIgY","./ca.js":"wIgY","./cs":"ssxj","./cs.js":"ssxj","./cv":"N3vo","./cv.js":"N3vo","./cy":"ZFGz","./cy.js":"ZFGz","./da":"YBA/","./da.js":"YBA/","./de":"DOkx","./de-at":"8v14","./de-at.js":"8v14","./de-ch":"Frex","./de-ch.js":"Frex","./de.js":"DOkx","./dv":"rIuo","./dv.js":"rIuo","./el":"CFqe","./el.js":"CFqe","./en-au":"Sjoy","./en-au.js":"Sjoy","./en-ca":"Tqun","./en-ca.js":"Tqun","./en-gb":"hPuz","./en-gb.js":"hPuz","./en-ie":"ALEw","./en-ie.js":"ALEw","./en-il":"QZk1","./en-il.js":"QZk1","./en-nz":"dyB6","./en-nz.js":"dyB6","./eo":"Nd3h","./eo.js":"Nd3h","./es":"LT9G","./es-do":"7MHZ","./es-do.js":"7MHZ","./es-us":"INcR","./es-us.js":"INcR","./es.js":"LT9G","./et":"XlWM","./et.js":"XlWM","./eu":"sqLM","./eu.js":"sqLM","./fa":"2pmY","./fa.js":"2pmY","./fi":"nS2h","./fi.js":"nS2h","./fo":"OVPi","./fo.js":"OVPi","./fr":"tzHd","./fr-ca":"bXQP","./fr-ca.js":"bXQP","./fr-ch":"VK9h","./fr-ch.js":"VK9h","./fr.js":"tzHd","./fy":"g7KF","./fy.js":"g7KF","./gd":"nLOz","./gd.js":"nLOz","./gl":"FuaP","./gl.js":"FuaP","./gom-latn":"+27R","./gom-latn.js":"+27R","./gu":"rtsW","./gu.js":"rtsW","./he":"Nzt2","./he.js":"Nzt2","./hi":"ETHv","./hi.js":"ETHv","./hr":"V4qH","./hr.js":"V4qH","./hu":"xne+","./hu.js":"xne+","./hy-am":"GrS7","./hy-am.js":"GrS7","./id":"yRTJ","./id.js":"yRTJ","./is":"upln","./is.js":"upln","./it":"FKXc","./it.js":"FKXc","./ja":"ORgI","./ja.js":"ORgI","./jv":"JwiF","./jv.js":"JwiF","./ka":"RnJI","./ka.js":"RnJI","./kk":"j+vx","./kk.js":"j+vx","./km":"5j66","./km.js":"5j66","./kn":"gEQe","./kn.js":"gEQe","./ko":"eBB/","./ko.js":"eBB/","./ky":"6cf8","./ky.js":"6cf8","./lb":"z3hR","./lb.js":"z3hR","./lo":"nE8X","./lo.js":"nE8X","./lt":"/6P1","./lt.js":"/6P1","./lv":"jxEH","./lv.js":"jxEH","./me":"svD2","./me.js":"svD2","./mi":"gEU3","./mi.js":"gEU3","./mk":"Ab7C","./mk.js":"Ab7C","./ml":"oo1B","./ml.js":"oo1B","./mn":"CqHt","./mn.js":"CqHt","./mr":"5vPg","./mr.js":"5vPg","./ms":"ooba","./ms-my":"G++c","./ms-my.js":"G++c","./ms.js":"ooba","./mt":"oCzW","./mt.js":"oCzW","./my":"F+2e","./my.js":"F+2e","./nb":"FlzV","./nb.js":"FlzV","./ne":"/mhn","./ne.js":"/mhn","./nl":"3K28","./nl-be":"Bp2f","./nl-be.js":"Bp2f","./nl.js":"3K28","./nn":"C7av","./nn.js":"C7av","./pa-in":"pfs9","./pa-in.js":"pfs9","./pl":"7LV+","./pl.js":"7LV+","./pt":"ZoSI","./pt-br":"AoDM","./pt-br.js":"AoDM","./pt.js":"ZoSI","./ro":"wT5f","./ro.js":"wT5f","./ru":"ulq9","./ru.js":"ulq9","./sd":"fW1y","./sd.js":"fW1y","./se":"5Omq","./se.js":"5Omq","./si":"Lgqo","./si.js":"Lgqo","./sk":"OUMt","./sk.js":"OUMt","./sl":"2s1U","./sl.js":"2s1U","./sq":"V0td","./sq.js":"V0td","./sr":"f4W3","./sr-cyrl":"c1x4","./sr-cyrl.js":"c1x4","./sr.js":"f4W3","./ss":"7Q8x","./ss.js":"7Q8x","./sv":"Fpqq","./sv.js":"Fpqq","./sw":"DSXN","./sw.js":"DSXN","./ta":"+7/x","./ta.js":"+7/x","./te":"Nlnz","./te.js":"Nlnz","./tet":"gUgh","./tet.js":"gUgh","./tg":"5SNd","./tg.js":"5SNd","./th":"XzD+","./th.js":"XzD+","./tl-ph":"3LKG","./tl-ph.js":"3LKG","./tlh":"m7yE","./tlh.js":"m7yE","./tr":"k+5o","./tr.js":"k+5o","./tzl":"iNtv","./tzl.js":"iNtv","./tzm":"FRPF","./tzm-latn":"krPU","./tzm-latn.js":"krPU","./tzm.js":"FRPF","./ug-cn":"To0v","./ug-cn.js":"To0v","./uk":"ntHu","./uk.js":"ntHu","./ur":"uSe8","./ur.js":"uSe8","./uz":"XU1s","./uz-latn":"/bsm","./uz-latn.js":"/bsm","./uz.js":"XU1s","./vi":"0X8Q","./vi.js":"0X8Q","./x-pseudo":"e/KL","./x-pseudo.js":"e/KL","./yo":"YXlc","./yo.js":"YXlc","./zh-cn":"Vz2w","./zh-cn.js":"Vz2w","./zh-hk":"ZUyn","./zh-hk.js":"ZUyn","./zh-tw":"BbgG","./zh-tw.js":"BbgG"};function n(t){return s(a(t))}function a(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}n.keys=function(){return Object.keys(i)},n.resolve=a,t.exports=n,n.id="uslO"},zj2Q:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.js.map